# ü§ñ GitHub PR Manager with AI Integration

A production-ready GitHub automation system powered by SmolLM2 AI for intelligent PR analysis, risk assessment, and automated workflow management.

> ü§ñ See [.github/copilot-instructions.md](.github/copilot-instructions.md) for AI guidelines.

## ‚ú® Features

### üîç **AI-Powered Analysis**
- **Intelligent PR Risk Assessment** - Automatic classification (low/medium/high/critical)
- **Code Review Suggestions** - AI-generated constructive feedback
- **Issue Categorization** - Smart labeling and priority assignment
- **Security Concern Detection** - Identifies potential security risks
- **Technical Debt Analysis** - Highlights code quality issues

### üöÄ **Automated Workflows**
- **Real-time Webhook Processing** - Instant PR/issue analysis
- **Smart Labeling** - Automatic label assignment based on AI analysis
- **Review Comment Generation** - Professional, actionable feedback
- **Draft PR Management** - Configurable promotion policies
- **Scheduled Analysis** - Background processing every 5 minutes

### üìä **Production Ready**
- **Docker Compose Deployment** - Full stack with monitoring
- **Health Monitoring** - Comprehensive health checks and metrics
- **Graceful Fallbacks** - Rule-based analysis when AI unavailable
- **Security-First** - Webhook signature verification, token security
- **Scalable Architecture** - Redis caching, PostgreSQL storage

## üèóÔ∏è Architecture

```
GitHub Repository
       ‚Üì (Webhooks)
GitHub PR Manager ‚Üê‚Üí SmolLM2 AI Service
       ‚Üì
   Redis Cache ‚Üê‚Üí PostgreSQL
       ‚Üì
Prometheus Metrics ‚Üí Grafana Dashboard
```

### Core Components

1. **GitHub PR Manager** (`src/index.js`) - Main orchestration service
2. **AI Service Interface** (`src/ai-service.js`) - SmolLM2 integration
3. **Docker Stack** (`docker-compose-ai.yml`) - Complete infrastructure
4. **Monitoring** (`prometheus.yml`, Grafana) - Observability stack

## üöÄ Quick Start

### Prerequisites
- Node.js 18+
- Docker Desktop (for full stack)
- GitHub Personal Access Token
- SmolLM2 AI service (or compatible API)

### Option 1: Docker Deployment (Recommended)

```bash
# Clone and navigate
git clone https://github.com/brandonlacoste9-tech/adgenxai.git
cd adgenxai/agents

# Set environment variables
$env:GITHUB_TOKEN = "your_github_pat_token"
$env:GITHUB_REPOSITORY = "owner/repository"
$env:WEBHOOK_SECRET = "your_webhook_secret"

# Run setup script
.\setup-ai-integration.ps1 -Docker

# Verify deployment
.\test-ai-integration.ps1
```

### Option 2: Local Development

```bash
# Set environment variables
$env:GITHUB_TOKEN = "your_github_pat_token"
$env:GITHUB_REPOSITORY = "owner/repository"
$env:ENABLE_AI_ANALYSIS = "true"

# Run setup script
.\setup-ai-integration.ps1 -Development

# Test integration
.\test-ai-integration.ps1
```

## ‚öôÔ∏è Configuration

### Environment Variables

```bash
# Required
GITHUB_TOKEN=ghp_your_personal_access_token
GITHUB_REPOSITORY=owner/repository

# AI Configuration
ENABLE_AI_ANALYSIS=true
AI_SERVICE_URL=http://localhost:8000

# Optional
WEBHOOK_SECRET=your_webhook_secret
PROMOTE_DRAFTS=false
NODE_ENV=production
PORT=3001
```

### GitHub Repository Setup

1. **Create GitHub App** (recommended) or use Personal Access Token
2. **Configure Webhooks**:
   - URL: `https://your-domain.com/webhook`
   - Content type: `application/json`
   - Events: `Pull requests`, `Issues`
   - Secret: Your webhook secret

3. **Required Permissions**:
   - Repository: Read & Write
   - Pull requests: Read & Write
   - Issues: Read & Write
   - Metadata: Read

## ü§ñ AI Analysis Features

### PR Analysis Outputs

```json
{
  "riskLevel": "high",
  "priority": "high", 
  "suggestedReviewers": ["@security-team"],
  "concerns": [
    "Security-sensitive files modified",
    "Large changeset - thorough review needed"
  ],
  "recommendation": "request-changes",
  "summary": "Authentication system changes require security review",
  "aiGenerated": true
}
```

### Smart Labeling

- **Risk Levels**: `high-risk`, `critical-risk`
- **Priorities**: `high-priority`, `urgent`
- **AI Analysis**: `ai-analyzed`
- **Issue Types**: `bug`, `feature`, `enhancement`, `documentation`

### Review Comments

AI generates professional, constructive comments for high-risk PRs:

> **AI Analysis Summary**
> 
> Thanks for this contribution! I've identified some areas that need attention:
> 
> **Areas of concern:**
> - Security-sensitive file modifications detected
> - Large changeset requires comprehensive testing
> 
> Please ensure all security implications are reviewed and documented.
> 
> *This comment was generated by the GitHub PR management system.*

## üìä Monitoring & Analytics

### Service Endpoints

- **Health Check**: `GET /health`
- **Webhook Receiver**: `POST /webhook`

### Monitoring Stack (Docker)

- **Grafana Dashboard**: `http://localhost:3000`
- **Prometheus Metrics**: `http://localhost:9090`
- **Service Logs**: `docker compose logs -f`

### Key Metrics

- AI analysis success rate
- PR processing time
- Risk assessment accuracy
- API response times
- Error rates and types

## üîß Management Commands

### PM2 Management (Local)

```bash
# View status
npx pm2 status

# View logs
npx pm2 logs github-pr-manager

# Restart service
npx pm2 restart github-pr-manager

# Stop service
npx pm2 stop github-pr-manager
```

### Docker Management

```bash
# View all services
docker compose -f docker-compose-ai.yml ps

# View logs
docker compose -f docker-compose-ai.yml logs -f github-pr-manager

# Restart specific service
docker compose -f docker-compose-ai.yml restart github-pr-manager

# Stop all services
docker compose -f docker-compose-ai.yml down
```

## üõ°Ô∏è Security

### Best Practices

1. **Never commit tokens** - Use environment variables only
2. **Verify webhook signatures** - Always validate GitHub webhooks
3. **Secure AI service** - Ensure AI service doesn't store sensitive data
4. **Monitor access** - Track API usage and access patterns
5. **Regular updates** - Keep dependencies and Docker images updated

### Token Permissions

Minimum required GitHub token scopes:
- `repo` (full repository access)
- `write:discussion` (for PR comments)

## üß™ Testing

### Integration Tests

```bash
# Run comprehensive test suite
.\test-ai-integration.ps1

# Test with verbose output
.\test-ai-integration.ps1 -Verbose

# Test specific service URLs
.\test-ai-integration.ps1 -ServiceUrl "http://localhost:3001" -AIServiceUrl "http://localhost:8000"
```

### Manual Testing

1. **Create a test PR** in your repository
2. **Monitor logs** for AI analysis
3. **Check labels** applied automatically
4. **Verify comments** on high-risk PRs

## üîÄ Customization

### AI Analysis Rules

Modify `src/ai-service.js` to customize:
- Risk assessment criteria
- Comment generation templates
- Label assignment logic
- Analysis frequency

### Fallback Rules

When AI is unavailable, rule-based analysis includes:
- Security file pattern detection
- Large changeset identification
- Dependency update recognition
- Documentation-only changes

## üìö API Reference

### Health Check Response

```json
{
  "status": "healthy",
  "timestamp": "2025-11-03T12:00:00.000Z",
  "repo": "owner/repository",
  "mode": "production",
  "ai_enabled": true,
  "ai_service": "http://localhost:8000"
}
```

### Webhook Events

Supported GitHub webhook events:
- `pull_request` (opened, reopened, synchronize)
- `issues` (opened, reopened)

## üêõ Troubleshooting

### Common Issues

1. **AI Service Unavailable**
   - Check AI service health: `curl http://localhost:8000/health`
   - Verify service is running: `docker ps` or `pm2 status`
   - Falls back to rule-based analysis automatically

2. **GitHub API Rate Limiting**
   - Check token permissions and quotas
   - Implement exponential backoff (already included)
   - Consider GitHub App for higher limits

3. **Webhook Failures**
   - Verify webhook secret matches configuration
   - Check webhook delivery logs in GitHub settings
   - Ensure service is accessible from internet

### Debug Commands

```bash
# Check service health
curl http://localhost:3001/health

# View recent logs
npx pm2 logs github-pr-manager --lines 50

# Test AI service
curl -X POST http://localhost:8000/v1/chat/completions \
  -H "Content-Type: application/json" \
  -d '{"model":"ai/smollm2","messages":[{"role":"user","content":"test"}]}'

# Check GitHub API access
curl -H "Authorization: Bearer $env:GITHUB_TOKEN" https://api.github.com/user
```

## ü§ù Contributing

1. Fork the repository
2. Create a feature branch: `git checkout -b feature/amazing-feature`
3. Make changes and test thoroughly
4. Commit: `git commit -m 'Add amazing feature'`
5. Push: `git push origin feature/amazing-feature`
6. Open a Pull Request (and watch the AI analyze it!)

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- **SmolLM2** - Efficient AI model for code analysis
- **Octokit** - GitHub API integration
- **Express.js** - Web framework
- **PM2** - Process management
- **Docker** - Containerization

---

**Status**: ‚úÖ Production Ready  
**AI Integration**: ‚úÖ SmolLM2 Powered  
**Security**: ‚úÖ Enterprise Grade  
**Monitoring**: ‚úÖ Full Observability  

Transform your GitHub workflow with intelligent automation! üöÄ
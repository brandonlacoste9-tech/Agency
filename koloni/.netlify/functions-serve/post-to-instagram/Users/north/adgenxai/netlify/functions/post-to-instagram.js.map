{
  "version": 3,
  "sources": ["../../../../adgenxai/netlify/functions/post-to-instagram.ts", "../../../../adgenxai/lib/platforms/instagram.ts"],
  "sourceRoot": "C:/Users/north/AppData/Local/Temp/tmp-28196-Vp7SQdav5w9E",
  "sourcesContent": ["// netlify/functions/post-to-instagram.ts\n// Netlify function to publish images to Instagram\n\nimport { Handler, HandlerEvent, HandlerContext } from \"@netlify/functions\";\nimport { publishImage } from \"../../lib/platforms/instagram\";\n\ninterface PostRequest {\n  imageUrl: string;\n  caption: string;\n}\n\nexport const handler: Handler = async (\n  event: HandlerEvent,\n  context: HandlerContext\n) => {\n  // Only allow POST requests\n  if (event.httpMethod !== \"POST\") {\n    return {\n      statusCode: 405,\n      body: JSON.stringify({ error: \"Method not allowed. Use POST.\" }),\n    };\n  }\n\n  try {\n    // Parse request body\n    const body: PostRequest = JSON.parse(event.body || \"{}\");\n    const { imageUrl, caption } = body;\n\n    // Validate inputs\n    if (!imageUrl || !caption) {\n      return {\n        statusCode: 400,\n        body: JSON.stringify({\n          error: \"Missing required fields: imageUrl and caption\",\n        }),\n      };\n    }\n\n    // Get Instagram credentials from environment variables\n    const accountId = process.env.INSTAGRAM_ACCOUNT_ID;\n    const accessToken = process.env.INSTAGRAM_ACCESS_TOKEN;\n\n    if (!accountId || !accessToken) {\n      return {\n        statusCode: 500,\n        body: JSON.stringify({\n          error: \"Instagram credentials not configured. Set INSTAGRAM_ACCOUNT_ID and INSTAGRAM_ACCESS_TOKEN environment variables.\",\n        }),\n      };\n    }\n\n    // Publish to Instagram\n    const result = await publishImage(\n      { accountId, accessToken },\n      imageUrl,\n      caption\n    );\n\n    return {\n      statusCode: 200,\n      headers: { \"Content-Type\": \"application/json\" },\n      body: JSON.stringify({\n        success: true,\n        platform: \"instagram\",\n        containerId: result.containerId,\n        publishedId: result.publishedId,\n        message: \"Successfully published to Instagram\",\n      }),\n    };\n  } catch (error: any) {\n    console.error(\"Instagram posting error:\", error);\n    return {\n      statusCode: 500,\n      body: JSON.stringify({\n        error: \"Failed to post to Instagram\",\n        details: error.message,\n      }),\n    };\n  }\n};\n", "// lib/platforms/instagram.ts\n// Instagram Graph API publishing helpers\n\nexport type InstagramConfig = {\n  accountId: string;\n  accessToken: string;\n};\n\nexport async function publishImage(\n  config: InstagramConfig,\n  imageUrl: string,\n  caption: string\n): Promise<{ containerId: string; publishedId: string }> {\n  const { accountId, accessToken } = config;\n\n  const createRes = await fetch(\n    `https://graph.facebook.com/v17.0/${ accountId}/media`,\n    {\n      method: \"POST\",\n      body: new URLSearchParams({\n        image_url: imageUrl,\n        caption,\n        access_token: accessToken,\n      }),\n    }\n  );\n\n  const createData = (await createRes.json()) as { id?: string };\n  if (!createData.id) {\n    throw new Error(`Failed to create Instagram media: ${JSON.stringify(createData)}`);\n  }\n\n  const publishRes = await fetch(\n    `https://graph.facebook.com/v17.0/${accountId}/media_publish`,\n    {\n      method: \"POST\",\n      body: new URLSearchParams({\n        creation_id: createData.id,\n        access_token: accessToken,\n      }),\n    }\n  );\n\n  const publishData = (await publishRes.json()) as { id?: string };\n  if (!publishData.id) {\n    throw new Error(`Failed to publish Instagram media: ${JSON.stringify(publishData)}`);\n  }\n\n  return { containerId: createData.id, publishedId: publishData.id };\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;;;ACQA,eAAsB,aACpB,QACA,UACA,SACuD;AACvD,QAAM,EAAE,WAAW,YAAY,IAAI;AAEnC,QAAM,YAAY,MAAM;AAAA,IACtB,oCAAqC,SAAS;AAAA,IAC9C;AAAA,MACE,QAAQ;AAAA,MACR,MAAM,IAAI,gBAAgB;AAAA,QACxB,WAAW;AAAA,QACX;AAAA,QACA,cAAc;AAAA,MAChB,CAAC;AAAA,IACH;AAAA,EACF;AAEA,QAAM,aAAc,MAAM,UAAU,KAAK;AACzC,MAAI,CAAC,WAAW,IAAI;AAClB,UAAM,IAAI,MAAM,qCAAqC,KAAK,UAAU,UAAU,CAAC,EAAE;AAAA,EACnF;AAEA,QAAM,aAAa,MAAM;AAAA,IACvB,oCAAoC,SAAS;AAAA,IAC7C;AAAA,MACE,QAAQ;AAAA,MACR,MAAM,IAAI,gBAAgB;AAAA,QACxB,aAAa,WAAW;AAAA,QACxB,cAAc;AAAA,MAChB,CAAC;AAAA,IACH;AAAA,EACF;AAEA,QAAM,cAAe,MAAM,WAAW,KAAK;AAC3C,MAAI,CAAC,YAAY,IAAI;AACnB,UAAM,IAAI,MAAM,sCAAsC,KAAK,UAAU,WAAW,CAAC,EAAE;AAAA,EACrF;AAEA,SAAO,EAAE,aAAa,WAAW,IAAI,aAAa,YAAY,GAAG;AACnE;;;ADtCO,IAAM,UAAmB,OAC9B,OACA,YACG;AAEH,MAAI,MAAM,eAAe,QAAQ;AAC/B,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU,EAAE,OAAO,gCAAgC,CAAC;AAAA,IACjE;AAAA,EACF;AAEA,MAAI;AAEF,UAAM,OAAoB,KAAK,MAAM,MAAM,QAAQ,IAAI;AACvD,UAAM,EAAE,UAAU,QAAQ,IAAI;AAG9B,QAAI,CAAC,YAAY,CAAC,SAAS;AACzB,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU;AAAA,UACnB,OAAO;AAAA,QACT,CAAC;AAAA,MACH;AAAA,IACF;AAGA,UAAM,YAAY,QAAQ,IAAI;AAC9B,UAAM,cAAc,QAAQ,IAAI;AAEhC,QAAI,CAAC,aAAa,CAAC,aAAa;AAC9B,aAAO;AAAA,QACL,YAAY;AAAA,QACZ,MAAM,KAAK,UAAU;AAAA,UACnB,OAAO;AAAA,QACT,CAAC;AAAA,MACH;AAAA,IACF;AAGA,UAAM,SAAS,MAAM;AAAA,MACnB,EAAE,WAAW,YAAY;AAAA,MACzB;AAAA,MACA;AAAA,IACF;AAEA,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,SAAS,EAAE,gBAAgB,mBAAmB;AAAA,MAC9C,MAAM,KAAK,UAAU;AAAA,QACnB,SAAS;AAAA,QACT,UAAU;AAAA,QACV,aAAa,OAAO;AAAA,QACpB,aAAa,OAAO;AAAA,QACpB,SAAS;AAAA,MACX,CAAC;AAAA,IACH;AAAA,EACF,SAAS,OAAY;AACnB,YAAQ,MAAM,4BAA4B,KAAK;AAC/C,WAAO;AAAA,MACL,YAAY;AAAA,MACZ,MAAM,KAAK,UAAU;AAAA,QACnB,OAAO;AAAA,QACP,SAAS,MAAM;AAAA,MACjB,CAAC;AAAA,IACH;AAAA,EACF;AACF;",
  "names": []
}
